const Plugin=videojs.getPlugin("plugin"),Component=videojs.getComponent("Component");var _vjs4={on:function(e,t,s,i){e.addEventListener(t,s,i)},off:function(e,t,s,i){e.removeEventListener(t,s,i)},addClass:function(e,t){e.classList.add(t)},removeClass:function(e,t){e.classList.remove(t)},findPosition:function(e){return e.getBoundingClientRect()},round:function(e,t){return parseFloat(e.toFixed(t))},formatTime:function(e){var t=Math.floor(e/60).toFixed(0),s=(e%60).toFixed(0);return 1===s.length&&(s="0"+s),t+":"+s},blockTextSelection:function(){}};class ControlTimePanelRight extends Component{constructor(e,t){super(e,t),this.on("keyup",this.onKeyUp),this.on("keydown",this.onKeyDown)}init_(){this.rs=this.player_.rangeslider,this.timeOld={}}createEl(){return super.createEl("div",{className:"vjs-controltimepanel-right-RS",innerHTML:'End: <input type="text" id="controltimepanel" maxlength="2" value="00"/>:<input type="text" id="controltimepanel" maxlength="2" value="00"/>:<input type="text" id="controltimepanel" maxlength="2" value="00"/>'})}onKeyDown(e){this.timeOld[0]=this.el_.children[0].value,this.timeOld[1]=this.el_.children[1].value,this.timeOld[2]=this.el_.children[2].value}onKeyUp(e){this.rs._checkControlTime(1,this.el_.children,this.timeOld)}}class ControlTimePanelLeft extends Component{constructor(e,t){super(e,t),this.on("keyup",this.onKeyUp),this.on("keydown",this.onKeyDown)}init_(){this.rs=this.player_.rangeslider,this.timeOld={}}createEl(){return super.createEl("div",{className:"vjs-controltimepanel-left-RS",innerHTML:'Start: <input type="text" id="controltimepanel" maxlength="2" value="00"/>:<input type="text" id="controltimepanel" maxlength="2" value="00"/>:<input type="text" id="controltimepanel" maxlength="2" value="00"/>'})}onKeyDown(e){this.timeOld[0]=this.el_.children[0].value,this.timeOld[1]=this.el_.children[1].value,this.timeOld[2]=this.el_.children[2].value}onKeyUp(e){this.rs._checkControlTime(0,this.el_.children,this.timeOld)}}class ControlTimePanel extends Component{constructor(e,t){super(e,t)}init_(){this.rs=this.player_.rangeslider}createEl(){return super.createEl("div",{className:"vjs-controltimepanel-RS vjs-control"})}enable(e){e=void 0===e||e,this.rs.ctpl.el_.children[0].disabled=e?"":"disabled",this.rs.ctpl.el_.children[1].disabled=e?"":"disabled",this.rs.ctpl.el_.children[2].disabled=e?"":"disabled",this.rs.ctpr.el_.children[0].disabled=e?"":"disabled",this.rs.ctpr.el_.children[1].disabled=e?"":"disabled",this.rs.ctpr.el_.children[2].disabled=e?"":"disabled"}}ControlTimePanel.prototype.options_={children:["ControlTimePanelLeft","ControlTimePanelRight"]};class TimePanelLeft extends Component{constructor(e,t){super(e,t)}init_(){this.rs=this.player_.rangeslider}createEl(){return super.createEl("div",{className:"vjs-timepanel-left-RS",innerHTML:'<span class="vjs-time-text">00:00</span>'})}}class TimePanelRight extends Component{constructor(e,t){super(e,t)}init_(){this.rs=this.player_.rangeslider}createEl(){return super.createEl("div",{className:"vjs-timepanel-right-RS",innerHTML:'<span class="vjs-time-text">00:00</span>'})}}class RSTimeBar extends Component{constructor(e,t){super(e,t)}init_(){this.rs=this.player_.rangeslider}createEl(){return super.createEl("div",{className:"vjs-timebar-RS",innerHTML:""})}}RSTimeBar.prototype.options_={children:["SeekRSBar"]};class SeekRSBar extends Component{constructor(e,t){super(e,t),this.on("mousedown",this.onMouseDown)}init_(){this.rs=this.player_.rangeslider}createEl(){return super.createEl("div",{className:"vjs-rangeslider-holder"})}onMouseDown(e){e.preventDefault(),_vjs4.blockTextSelection(),this.rs.options.locked||(_vjs4.on(document,"mousemove",videojs.bind(this,this.onMouseMove)),_vjs4.on(document,"mouseup",videojs.bind(this,this.onMouseUp)))}onMouseUp(e){_vjs4.off(document,"mousemove",this.onMouseMove,!1),_vjs4.off(document,"mouseup",this.onMouseUp,!1)}onMouseMove(e){var t=this.calculateDistance(e);this.rs.left.pressed?this.setPosition(0,t):this.rs.right.pressed&&this.setPosition(1,t);var s=this.player_.controlBar.currentTimeDisplay;s.contentEl_.innerHTML='<span class="vjs-control-text">'+s.localize("Current Time")+"</span>"+_vjs4.formatTime(this.rs._seconds(t),this.player_.duration()),(this.rs.left.pressed||this.rs.right.pressed)&&this.rs._triggerSliderChange()}setPosition(e,t,s){if(s=void 0===s||s,e=e||0,console.log("123",this.player_,this.player_.options,Object.keys(this.rs),this.rs.options),this.rs.options.locked)return!1;if(isNaN(t))return!1;if(0!==e&&1!==e)return!1;var i=this.rs.left.el_,r=(this.rs.right.el_,this.rs[0===e?"left":"right"].el_),n=this.rs.tpr.el_,o=this.rs.tpl.el_,l=this.rs.bar;if(0===e?l.updateLeft(t):l.updateRight(t)){r.style.left=100*t+"%",0===e?l.updateLeft(t):l.updateRight(t),this.rs[0===e?"start":"end"]=this.rs._seconds(t),0===e&&(i.style.zIndex=t>=.9?25:10);var a,h,p,d=_vjs4.formatTime(this.rs._seconds(t)),c=o.children[0].innerHTML.length;if(p=c<=4?this.player_.isFullScreen?3.25:6.5:c<=5?this.player_.isFullScreen?4:8:this.player_.isFullScreen?5:10,d.length<=4?(a=this.player_.isFullScreen?97:93,h=this.player_.isFullScreen?.1:.5):d.length<=5?(a=this.player_.isFullScreen?96:92,h=this.player_.isFullScreen?.1:.5):(a=this.player_.isFullScreen?95:91,h=this.player_.isFullScreen?.1:.5),0===e?(o.style.left=Math.max(h,Math.min(a,100*t-p/2))+"%",n.style.left.replace("%","")-o.style.left.replace("%","")<=p&&(o.style.left=Math.max(h,Math.min(a,n.style.left.replace("%","")-p))+"%"),o.children[0].innerHTML=d):(n.style.left=Math.max(h,Math.min(a,100*t-p/2))+"%",(n.style.left.replace("%","")||100)-o.style.left.replace("%","")<=p&&(n.style.left=Math.max(h,Math.min(a,o.style.left.replace("%","")-0+p))+"%"),n.children[0].innerHTML=d),s){var u=d.split(":");2==u.length?(0,u[0],u[1]):(u[0],u[1],u[2])}}return!0}calculateDistance(e){var t=this.getRSTBX(),s=this.getRSTBWidth(),i=this.getWidth();return t+=i/2,s-=i,Math.max(0,Math.min(1,(e.pageX-t)/s))}getRSTBWidth(){return this.el_.offsetWidth}getRSTBX(){return _vjs4.findPosition(this.el_).left}getWidth(){return this.rs.left.el_.offsetWidth}}SeekRSBar.prototype.options_={children:["SelectionBar","SelectionBarLeft","SelectionBarRight","TimePanel"]};class SelectionBar extends Component{constructor(e,t){super(e,t),this.on("mouseup",this.onMouseUp),this.fired=!1}init_(){this.rs=this.player_.rangeslider}createEl(){return super.createEl("div",{className:"vjs-selectionbar-RS"})}onMouseUp(){var e=this.rs.left.el_.style.left.replace("%",""),t=this.rs.right.el_.style.left.replace("%",""),s=this.player_.duration(),i=this.rs.updatePrecision,r=_vjs4.round(e*s/100,i),n=_vjs4.round(t*s/100,i);this.player_.currentTime(r),this.player_.play(),this.rs.bar.activatePlay(r,n)}updateLeft(e){var t=""!==this.rs.right.el_.style.left?this.rs.right.el_.style.left:100,s=parseFloat(t)/100,i=_vjs4.round(s-e,this.rs.updatePrecision);return e<=s+1e-5&&(this.rs.bar.el_.style.left=100*e+"%",this.rs.bar.el_.style.width=100*i+"%",!0)}updateRight(e){var t=""!==this.rs.left.el_.style.left?this.rs.left.el_.style.left:0,s=parseFloat(t)/100,i=_vjs4.round(e-s,this.rs.updatePrecision);return e+1e-5>=s&&(this.rs.bar.el_.style.width=100*i+"%",this.rs.bar.el_.style.left=100*(e-i)+"%",!0)}activatePlay(e,t){this.timeStart=e,this.timeEnd=t,this.suspendPlay(),this.player_.on("timeupdate",videojs.bind(this,this._processPlay))}suspendPlay(){this.fired=!1,this.player_.off("timeupdate",videojs.bind(this,this._processPlay))}_processPlay(){if(this.player_.currentTime()>=this.timeStart&&(this.timeEnd<0||this.player_.currentTime()<this.timeEnd)){if(this.fired)return;this.fired=!0}else{if(!this.fired)return;this.fired=!1,this.player_.pause(),this.player_.currentTime(this.timeEnd),this.suspendPlay()}}process_loop(){var e=this.player;if(e&&this.looping){var t=e.currentTime();(t<this.timeStart||this.timeEnd>0&&this.timeEnd<t)&&e.currentTime(this.timeStart)}}}class SelectionBarLeft extends Component{constructor(e,t){super(e,t),this.on("mousedown",this.onMouseDown),this.pressed=!1}init_(){this.rs=this.player_.rangeslider}createEl(){return super.createEl("div",{className:"vjs-rangeslider-handle vjs-selectionbar-left-RS",innerHTML:'<div class="vjs-selectionbar-arrow-RS"></div><div class="vjs-selectionbar-line-RS"></div>'})}onMouseDown(e){e.preventDefault(),_vjs4.blockTextSelection(),this.rs.options.locked||(this.pressed=!0,_vjs4.on(document,"mouseup",videojs.bind(this,this.onMouseUp)),_vjs4.addClass(this.el_,"active"))}onMouseUp(e){_vjs4.off(document,"mouseup",this.onMouseUp,!1),_vjs4.removeClass(this.el_,"active"),this.rs.options.locked||(this.pressed=!1)}}class SelectionBarRight extends Component{constructor(e,t){super(e,t),this.on("mousedown",this.onMouseDown),this.pressed=!1}init_(){this.rs=this.player_.rangeslider}createEl(){return super.createEl("div",{className:"vjs-rangeslider-handle vjs-selectionbar-right-RS",innerHTML:'<div class="vjs-selectionbar-arrow-RS"></div><div class="vjs-selectionbar-line-RS"></div>'})}onMouseDown(e){e.preventDefault(),_vjs4.blockTextSelection(),this.rs.options.locked||(this.pressed=!0,_vjs4.on(document,"mouseup",videojs.bind(this,this.onMouseUp)),_vjs4.addClass(this.el_,"active"))}onMouseUp(e){_vjs4.off(document,"mouseup",this.onMouseUp,!1),_vjs4.removeClass(this.el_,"active"),this.rs.options.locked||(this.pressed=!1)}}class TimePanel extends Component{constructor(e,t){super(e,t)}init_(){this.rs=this.player_.rangeslider}createEl(){return super.createEl("div",{className:"vjs-timepanel-RS"})}}TimePanel.prototype.options_={children:["TimePanelLeft","TimePanelRight"]};class rangeSlider_ extends Plugin{constructor(e,t={}){super(e,t);e=e;console.log("=== rangeSlider_ constructor ==="),console.log("00",e,e.rangeSlider),e.rangeslider=new RangeSlider(e,t),console.log("01",e,e.rangeslider.options),e.one("playing",function(t){var s=e.rangeslider;for(var i in console.log("02",e,e.rangeslider),s.components)s.components[i].init_();s.options.hidden&&s.hide(),s.options.locked&&s.lock(),!1===s.options.panel&&s.hidePanel(),!1===s.options.controlTime&&s.hidecontrolTime(),s._reset(),e.trigger("loadedRangeSlider")})}}class RangeSlider{constructor(e,t={}){console.log("rangeSlider constructor");var s=e||this;this.player=s,this.components={},(t=t||{}).hasOwnProperty("locked")||(t.locked=!1),t.hasOwnProperty("hidden")||(t.hidden=!0),t.hasOwnProperty("panel")||(t.panel=!0),this.options=t,this.init()}dispose(){super.dispose(),videojs.log("the rangeSlider plugin is being disposed")}updateState(){this.setState({playing:!this.player.paused()})}logState(e){videojs.log(`the player is now ${this.state.playing?"playing":"paused"}`)}init(){var e=this.player||{};this.updatePrecision=3,this.start=0,this.end=0;var t=e.controlBar.progressControl.seekBar;this.components.RSTimeBar=t.RSTimeBar,this.rstb=this.components.RSTimeBar,this.box=this.components.SeekRSBar=this.rstb.SeekRSBar,this.bar=this.components.SelectionBar=this.box.SelectionBar,this.left=this.components.SelectionBarLeft=this.box.SelectionBarLeft,this.right=this.components.SelectionBarRight=this.box.SelectionBarRight,this.tp=this.components.TimePanel=this.box.TimePanel,this.tpl=this.components.TimePanelLeft=this.tp.TimePanelLeft,this.tpr=this.components.TimePanelRight=this.tp.TimePanelRight}lock(){this.options.locked=!0,void 0!==this.box&&_vjs4.addClass(this.box.el_,"locked")}unlock(){this.options.locked=!1,void 0!==this.box&&_vjs4.removeClass(this.box.el_,"locked")}show(){this.options.hidden=!1,void 0!==this.rstb&&(this.rstb.show(),this.options.controlTime&&this.showcontrolTime())}hide(){this.options.hidden=!0,void 0!==this.rstb&&this.rstb.hide()}showPanel(){this.options.panel=!0,void 0!==this.tp&&_vjs4.removeClass(this.tp.el_,"disable")}hidePanel(){this.options.panel=!1,void 0!==this.tp&&_vjs4.addClass(this.tp.el_,"disable")}showcontrolTime(){this.options.controlTime=!0,void 0!==this.ctp&&this.ctp.show()}hidecontrolTime(){this.options.controlTime=!1,void 0!==this.ctp&&this.ctp.hide()}setValue(e,t,s){console.log("set value"),s=void 0===s||s;var i=this._percent(t),r=0===e||1===e;!this.locked&&r&&this.box.setPosition(e,i,s)}setValues(e,t,s){s=void 0===s||s,this._reset(),this._setValuesLocked(e,t,s)}getValues(){return{start:this.start||this._getArrowValue(0),end:this.end||this._getArrowValue(1)}}playBetween(e,t,s){s=void 0===s||s,this.player.currentTime(e),this.player.play(),s?(this.show(),this._reset()):this.hide(),this._setValuesLocked(e,t),this.bar.activatePlay(e,t)}loop(e,t,s){var i=this.player;i&&(i.on("pause",videojs.bind(this,function(){this.looping=!1})),(s=void 0===s||s)?(this.show(),this._reset()):this.hide(),this._setValuesLocked(e,t),this.timeStart=e,this.timeEnd=t,this.looping=!0,this.player.currentTime(e),this.player.play(),this.player.on("timeupdate",videojs.bind(this,this.bar.process_loop)))}_getArrowValue(e){e=e||0;var t=this.player.duration();t=void 0===t?0:t;var s=this[0===e?"left":"right"].el_.style.left.replace("%","");return""===s&&(s=0===e?0:100),_vjs4.round(this._seconds(s/100),this.updatePrecision-1)}_percent(e){var t=this.player.duration();return isNaN(t)?0:Math.min(1,Math.max(0,e/t))}_seconds(e){var t=this.player.duration();return isNaN(t)?0:Math.min(t,Math.max(0,e*t))}_reset(){var e=this.player.duration();this.tpl.el_.style.left="0%",this.tpr.el_.style.left="100%",this._setValuesLocked(0,e)}_setValuesLocked(e,t,s){var i=void 0!==s;s=void 0===s||s,this.options.locked?(this.unlock(),this.setValue(0,e,s),this.setValue(1,t,s),this.lock()):(this.setValue(0,e,s),this.setValue(1,t,s)),i&&this._triggerSliderChange()}_checkControlTime(e,t,s){var i,r,n,o=t[0],l=t[1],a=t[2],h=o.value,p=l.value,d=a.value;if(e=e||0,h!=s[0])i=o,r=h,n=s[0];else if(p!=s[1])i=l,r=p,n=s[1];else{if(d==s[2])return!1;i=a,r=d,n=s[2]}var c,u=this.player.duration()||0;(!/^\d+$/.test(r)||r>60)&&(r=""===r?"":n),h=""===h?0:h,p=""===p?0:p,d=""===d?0:d,(c=videojs.TextTrack.prototype.parseCueTime(h+":"+p+":"+d))>u?(i.value=n,i.style.border="1px solid red"):(i.value=r,o.style.border=l.style.border=a.style.border="1px solid transparent",this.setValue(e,c,!1),this._triggerSliderChange())}_triggerSliderChange(){this.player.trigger("sliderchange")}}!function(){Component.registerComponent("SelectionBar",SelectionBar),Component.registerComponent("SelectionBarLeft",SelectionBarLeft),Component.registerComponent("SelectionBarRight",SelectionBarRight),Component.registerComponent("SeekRSBar",SeekRSBar),Component.registerComponent("RSTimeBar",RSTimeBar),Component.registerComponent("TimePanel",TimePanel),Component.registerComponent("TimePanelLeft",TimePanelLeft),Component.registerComponent("TimePanelRight",TimePanelRight),Component.registerComponent("ControlTimePanel",ControlTimePanel),Component.registerComponent("ControlTimePanelLeft",ControlTimePanelLeft),Component.registerComponent("ControlTimePanelRight",ControlTimePanelRight),videojs.registerPlugin("rangeSlider",rangeSlider_),Component.getComponent("SeekBar").prototype.options_.children.push("RSTimeBar"),Component.getComponent("ControlBar").prototype.options_.children.push("ControlTimePanel");var e=Component.getComponent("Player");e.prototype.lockSlider=function(){return this.rangeSlider.lock()},e.prototype.unlockSlider=function(){return this.rangeSlider.unlock()},e.prototype.showSlider=function(){return this.rangeSlider.show()},e.prototype.hideSlider=function(){return this.rangeSlider.hide()},e.prototype.showSliderPanel=function(){return this.rangeSlider.showPanel()},e.prototype.hideSliderPanel=function(){return this.rangeSlider.hidePanel()},e.prototype.showControlTime=function(){return this.rangeSlider.showcontrolTime()},e.prototype.hideControlTime=function(){return this.rangeSlider.hidecontrolTime()},e.prototype.setValueSlider=function(e,t){return this.rangeSlider.setValues(e,t)},e.prototype.playBetween=function(e,t){return this.rangeSlider.playBetween(e,t)},e.prototype.loopBetween=function(e,t){return this.rangeSlider.loop(e,t)},e.prototype.getValueSlider=function(){return this.rangeSlider.getValues()}}();export default rangeSlider_;